```{r}
#Download data from this link:
#https://drive.google.com/drive/folders/1Fkkyi6w9h0ZDo1vcuOaAVi-I-l2QXOYg?usp=sharing
#Change paths on file. Data is too large to upload to GitHub

#Import 2020 Survey Data
library(haven)
RawData <- read_dta("/Users/Keith/Downloads/anes_timeseries_2020_stata_20210324/anes_timeseries_2020_stata_20210324.dta")

#Import Long-Term Data
library(haven)
RawData_LongTerm <- read_dta("/Users/Keith/Downloads/anes_timeseries_cdf_dta/anes_timeseries_cdf.dta")
```

```{r}
#Install packages, only run if first time using file
install.packages("skimr")
install.packages("dplyr") # manipulate dataframes
install.packages("readr") # read/write dataframes
install.packages("tidyr") # reshaping dataframes
install.packages("stringr") # string manipulation
install.packages("forcats") # factor manipulation
install.packages("purrr") # iteration (instead of loops)
install.packages("ggplot2") # making plots
install.packages("ggpmisc")
install.packages("gapminder")
install.packages("gganimate")

```

```{r}
#Selecting columns to keep for analysis and renaming them to make user friendly
library(dplyr)
RawData_SC <- RawData %>% 
  select(
    sex = V201600,
    sexual_orientation = V201601,
    violence_justification = V201602,
    money_in_stocks = V201606,
    total_income = V201607,
    total_household_income = V201617x,
    has_health_insurance = V201620,
    positive_covid = V201624,
    guns_owned = V201628,
    remarks_sexist = V201639,
    women_power_over_men = V201640,
    life_satisfaction = V201651,
    voter_registered = V202056,
    party_of_registration = V202064,
    did_vote = V202066,
    did_vote_president = V202072,
    who_for_president = V202073,
    time_before_decision = V202075,
    did_vote_house = V202080,
    who_for_house = V202081,
    did_vote_senate = V202087,
    who_for_senate = V202091,
    summary_voter_turnout = V202109x,
    summary_presidential_vote = V202110x,
    how_voted_2020 = V202117,
    how_usually_vote = V202118,
    difficulty_voting = V202119,
    ft_joe_biden = V202143,
    ft_donald_trump = V202144,
    ft_kamala_harris = V202156,
    ft_mike_pence = V202157,
    ft_fauci = V202158,
    ft_christian_fund = V202159,
    ft_feminists = V202160,
    ft_liberals = V202161,
    ft_labor_unions = V202162,
    ft_big_business = V202163,
    ft_conservatives = V202164,
    ft_supreme_court = V202165,
    ft_gay_men_lesbians = V202166,
    ft_congress = V202167,
    ft_muslims = V202168,
    ft_christians = V202169,
    ft_jews = V202170,
    ft_police = V202171,
    ft_trans_people = V202172,
    ft_scientists = V202173,
    ft_blm = V202174,
    ft_journalists = V202175,
    ft_socialists = V202179,
    ft_capitalists = V202180,
    ft_me_too = V202183,
    ft_rural_americans = V202184,
    incumbant_job_in_district = V202204,
    public_officials_dont_care = V202212,
    votes_counted_fairly = V202219,
    immigration_levels = V202232,
    favor_oppose_citizenship = V202242x,
    government_reduce_income_inequality = V202257,
    summ_gov_reduce_income_inequality = V202259x,
    society_equal_opp = V202260,
    summ_economic_mobility = V202320x,
    favor_oppose_tax_millionaires = V202325,
    favor_oppose_vaccine_schools = V202329,
    climate_change_importance = V202333,
    favor_oppose_12k_basic_income = V202374,
    min_wage_keep_lower_raise = V202377
    
  )
```

```{r}
#Overview of data with selected columns
library(tidyverse)
head(RawData_SC, 10)
tail(RawData_SC, 10)

library(skimr)
skim(RawData_SC)

summarize(RawData_SC)
```

```{r}
#Creating new datasets for numeric and character variables
#Converting to all numeric and exploring the data
RawData_SC_Num <- mutate_all(RawData_SC, function(x) as.numeric(as.character(x)))
library(skimr)
skim(RawData_SC_Num)

library(DataExplorer)
DataExplorer::create_report(RawData_SC_Num)

DataCharacters <- RawData_SC_Num
DataCharacters$who_for_president <- as.character(DataCharacters$who_for_president)
```

```{r}
#Trump vs Journalists Regression
library(ggpmisc)
library(ggplot2)
my.formula <- y ~ x
ggplot(data = RawData_SC) +
  aes(x = ft_donald_trump, y = ft_journalists, color = factor(sex)) +
  geom_point(size = 0.5, alpha = 0.25) +
  geom_smooth(method=lm, se=TRUE, show.legend=TRUE,formula = my.formula) +
   stat_poly_eq(formula = my.formula, 
                aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
                parse = TRUE) + 
  coord_cartesian(ylim = c(-10,110)) +
  labs(
    title = "Trump vs Journalists Thermometers",
    subtitle = "Factored via Sex",
    x = "Trump",
    y = "Journalists",
    caption = "Data via ANES",
  )
```
```{r}
#Selecting columns to keep for analysis and renaming them to make user friendly for long term data
RawData_LT_SC <- RawData_LongTerm %>% 
  select(
    year_lt = VCF0004,
    gender_lt = VCF0070b,
    income_group_lt = VCF0114,
    party_indentification = VCF0303,
    ft_lt_christian_fund = VCF0234,
    ft_lt_feminists = VCF0253,
    ft_lt_liberals = VCF0211,
    ft_lt_labor_unions = VCF0210,
    ft_lt_big_business = VCF0209,
    ft_lt_conservatives = VCF0212,
    ft_lt_congress = VCF0228,
    ft_lt_jews = VCF0205,
    ft_lt_police = VCF0214
    
  )
```

```{r}
head(RawData_LT_SC, 10)
skim(RawData_LT_SC)
DataExplorer::create_report(RawData_LT_SC)
```

```{r}
ggplot(data = RawData_LT_SC) +
  aes(x =(year_lt), y = ft_lt_liberals, fill=factor(party_indentification) ) +
  geom_bar(stat = "summary", width=1.75, position=position_dodge()) +
  theme_minimal() +
  coord_cartesian(xlim = c(1970,2016), ylim = c(0,75)) +
  labs(
    title = "Feeling Thermometer of Liberals by Year",
    subtitle = "Factored by Party",
    x = "Year",
    y = "Feeling Thermometer",
    caption = "Data via ANES",
  )
```

```{r}
ggplot(data = DataCharacters) +
  aes(x = who_for_president, y = ft_blm, color = factor(party_of_registration)) +
  geom_point(size = 0.5, alpha = 0.25) +
  stat_boxplot(fill = NA) +
  scale_x_discrete(limits = c(1, 2)) +
  coord_cartesian(xlim = c(1,2), ylim = c(-10,105)) +
  labs(
    title = "Trump vs Biden Voters Feelings on BLM",
    subtitle = "Factored via Party",
    x = "Biden vs. Trump",
    y = "Feeling Thermometer",
    caption = "Data via ANES",
  )
```

```{r}
#unfinished animation graph
RawData_LT_SC_Char <- RawData_LT_SC
RawData_LT_SC_Char$party_indentification <- as.character(RawData_LT_SC_Char$party_indentification)

library(ggplot2)
library(gapminder)
library(gganimate)

ggplot(data = RawData_LT_SC_Char) +
  aes(x = ft_lt_liberals, y = ft_lt_conservatives, size = income_group_lt, color = (party_indentification)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  #scale_colour_manual(values = (party_indentification)) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  facet_wrap(~party_indentification) +
  # Here comes the gganimate specific bits
  labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') +
  transition_time(year_lt) +
  ease_aes('linear')
```